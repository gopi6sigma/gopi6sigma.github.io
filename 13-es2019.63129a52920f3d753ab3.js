(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{Cimy:function(e,t,i){"use strict";i.r(t),i.d(t,"PaperUploadModule",(function(){return b}));var s=i("ofXK"),r=i("tyNb"),n=i("PCNd"),a=i("3Pt+"),c=i("QKVY"),o=i("XNiG"),l=i("fXoL"),d=i("yTNM"),h=i("Bfb3");function g(e,t){if(1&e&&(l.Lc(0,"p"),l.Cd(1),l.Kc()),2&e){const e=l.bd();l.rc(1),l.Ed("Status Here: ",e.status,"")}}function m(e,t){if(1&e){const e=l.Mc();l.Lc(0,"div",9),l.Lc(1,"webcam",10),l.Xc("imageCapture",(function(t){return l.sd(e),l.bd().snapshot(t)}))("initError",(function(t){return l.sd(e),l.bd().handleWebcamInitError(t)})),l.Kc(),l.Lc(2,"div"),l.Lc(3,"button",11),l.Xc("click",(function(){return l.sd(e),l.bd().captureImage()})),l.Cd(4),l.Kc(),l.Kc(),l.Kc()}if(2&e){const e=l.bd();l.rc(1),l.id("trigger",e.$trigger)("allowCameraSwitch",!0)("height",480)("width",640)("imageQuality",1)("videoOptions",e.videoOptions),l.rc(3),l.Dd(e.captureBtnLable)}}function p(e,t){if(1&e&&l.Gc(0,"img",12),2&e){const e=l.bd();l.id("src",e.webcamPreviewImage,l.vd)}}function u(e,t){if(1&e){const e=l.Mc();l.Lc(0,"div"),l.Lc(1,"button",13),l.Xc("click",(function(){return l.sd(e),l.bd().sendDetails()})),l.Cd(2,"Upload"),l.Kc(),l.Kc()}}const w=[{path:"",component:(()=>{class e{constructor(e,t,i,s,r){this.fb=e,this.cd=t,this.apiService=i,this.router=s,this.imageUploadService=r,this.labelsList=[],this.serverResponce="",this.isResponceSuccess=!1,this.showLeftDiv=!0,this.paperImage="",this.maxDate=(new Date).toLocaleDateString(),this.formSubmitted=!1,this.showWebcam=!0,this.allowCameraSwitch=!0,this.multipleWebcamsAvailable=!1,this.errors=[],this.previewImage="https://h5p.org/sites/default/files/styles/medium-logo/public/logos/drag-and-drop-icon.png?itok=0dFV3ej6",this.url="https://h5p.org/sites/default/files/styles/medium-logo/public/logos/drag-and-drop-icon.png?itok=0dFV3ej6",this.stream=null,this.status=null,this.trigger=new o.a,this.webcamPreviewImage="",this.webcamImg=null,this.captureBtnLable="",this.facingMode="environment"}ngOnInit(){c.c.getAvailableVideoInputs().then(e=>{this.multipleWebcamsAvailable=e&&e.length>1})}hideAlert(){this.showLeftDiv=!0,this.webcamPreviewImage=""}sendDetails(){try{if(this.paperImage){let e=new FormData;e.append("answerSheet",this.answerSheet),this.apiService.showLoader.next(!0),this.apiService.addPaperImage(e).subscribe(e=>{if(e&&"string"==typeof e){const t=JSON.parse(e);t&&t.message&&(this.apiService.genericMessage(t.message,"success"),this.apiService.showLoader.next(!1),this.showLeftDiv=!0,this.webcamPreviewImage="")}},e=>{if(this.apiService.showLoader.next(!1),401!==e.status){if(e.error){console.log(e.error);const t="string"==typeof e.error?JSON.parse(e.error):{};this.apiService.genericMessage(t.error||"something went wrong","error")}}else this.router.navigate(["/login"])})}}catch(e){console.warn(e)}}get videoOptions(){const e={};return this.facingMode&&""!==this.facingMode&&(e.facingMode={ideal:this.facingMode}),e}get $trigger(){return this.trigger.asObservable()}snapshot(e){console.log("snapshot",e),this.webcamPreviewImage=e.imageAsDataUrl,this.paperImage=e.imageAsDataUrl,this.captureBtnLable="Retake Image";const t=e.imageAsDataUrl.split(","),i=(t[0].match(/:(.*?);/),atob(t[1]));let s=i.length;const r=new Uint8Array(s);for(;s--;)r[s]=i.charCodeAt(s);const n=new File([r],"AnswerSheet",{type:"JPEG"});console.log(n),this.answerSheet=n}checkPermissions(){console.log("checkPermissions"),navigator.mediaDevices.getUserMedia({video:{width:500,height:500}}).then(e=>{console.log("Camera allowed: ",e),this.stream=e,this.status="Allowed",this.captureBtnLable="Capture Image"}).catch(e=>{console.log(e),this.status="Permission denied"===(null==e?void 0:e.message)?"Permission Denied please allow camera access":"Camera not found. Please retry..."})}captureImage(){this.trigger.next(),this.showLeftDiv=!1}handleWebcamInitError(e){e.mediaStreamError&&"NotAllowedError"===e.mediaStreamError.name&&console.warn("Camera access was not allowed by user!"),this.errors.push(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Fc(a.c),l.Fc(l.j),l.Fc(d.a),l.Fc(r.c),l.Fc(h.a))},e.\u0275cmp=l.zc({type:e,selectors:[["app-new-image-upload"]],inputs:{labelsList:"labelsList"},decls:12,vars:5,consts:[[1,"card","shadow"],[1,"card-body"],[1,"card-text"],[3,"formGroup"],[1,"col-12","col-sm-6","col-md-4","web-perms-button-div"],["type","button",1,"my-btn","web-perms-btn",3,"click"],[4,"ngIf"],["class","row",4,"ngIf"],["height","480","width","640",3,"src",4,"ngIf"],[1,"row"],[3,"trigger","allowCameraSwitch","height","width","imageQuality","videoOptions","imageCapture","initError"],["type","button",1,"my-btn","my-btn-primary",3,"click"],["height","480","width","640",3,"src"],["type","button",1,"mx-auto","my-btn","my-btn-primary",3,"click"]],template:function(e,t){1&e&&(l.Lc(0,"div",0),l.Lc(1,"div",1),l.Lc(2,"div",2),l.Lc(3,"form",3),l.Lc(4,"div",4),l.Lc(5,"button",5),l.Xc("click",(function(){return t.checkPermissions()})),l.Cd(6,"Webcam Permissions"),l.Kc(),l.Ad(7,g,2,1,"p",6),l.Kc(),l.Ad(8,m,5,7,"div",7),l.Lc(9,"div"),l.Ad(10,p,1,1,"img",8),l.Ad(11,u,3,0,"div",6),l.Kc(),l.Kc(),l.Kc(),l.Kc(),l.Kc()),2&e&&(l.rc(3),l.id("formGroup",t.galleryUpload),l.rc(4),l.id("ngIf",t.status),l.rc(1),l.id("ngIf",t.stream),l.rc(2),l.id("ngIf",t.webcamPreviewImage),l.rc(1),l.id("ngIf",t.webcamPreviewImage))},directives:[a.u,a.l,a.e,s.l,c.a],styles:[".title[_ngcontent-%COMP%]{font-weight:500;text-align:center}.dnd-container[_ngcontent-%COMP%]{width:100%;margin:auto;height:10rem;border:1px dashed #745cf2}.dnd-container[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{width:20%;height:20%}.label[_ngcontent-%COMP%]{display:inline-block;min-width:100px}#parent[_ngcontent-%COMP%]{display:flex}#left[_ngcontent-%COMP%], #right[_ngcontent-%COMP%]{border:1px solid #d3d3d3;background-color:#fff;width:50%;position:relative}.webcam-image[_ngcontent-%COMP%]{max-width:100%;height:auto;display:block;margin:0 auto}.preview-image[_ngcontent-%COMP%]{width:100%;height:15rem}.web-perms-button-div[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.web-perms-btn[_ngcontent-%COMP%]{color:#000}"]}),e})()}];let b=(()=>{class e{}return e.\u0275mod=l.Dc({type:e}),e.\u0275inj=l.Cc({factory:function(t){return new(t||e)},imports:[[s.b,r.g.forChild(w),a.r,a.f,n.a,c.b]]}),e})()}}]);